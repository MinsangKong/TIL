# Effective Java

# Item 65. 리플렉션보다는 인터페이스를 사용하라

- 리플렉션은 특정 상황에서 도움이 되는 접근법이지만 오버헤드, 보안 이슈 등의 단점도 많다
    - 그렇기 때문에 필요한 상황에서만 적절하게 사용해야 한다.
- 리플렉션은 되도록 객체 생성에만 사용하고 생성한 객체를 이용할 때는 적절한 인 터페이스나 컴파일타임에 알 수 있는 상위 클래스로 형변환하는 권장한다.

## Reflection

- 자바에서 실행 시간에 클래스, 인터페이스, 필드 및 메소드와 같은 객체의 정보를 조사하고 그 객체와 상호 작용하는 기능을 제공하는 접근법
    - 리플렉션을 통해 개발자는 메소드 정보, 필드 정보, 생성자 정보 등을 얻을 수 있다.
    - 즉, 리플렉션은 클래스나 객체의 정보를 동적으로 가져올 수 있는 방법을 제공한다.

    ```java
    public class ReflectionExample {
        public static void main(String[] args) {
            Class<?> stringClass = String.class;
    
            // 리플렉션을 통해 클래스 명을 알 수 있다. Class Name: String이 출력됨
            System.out.println("Class Name: " + stringClass.getName());
    
            // String 클래스에서 제공하는 모든 메서드를 문자열 배열로 얻을 수 있다
            Method[] methods = stringClass.getDeclaredMethods();
    
            for (Method method : methods) {
                System.out.println("Method Name: " + method.getName());
            }
        }
    }
    ```


### Reflection의 단점

- 리플렉션은 편리한 기능을 주는 만큼 단점이 크다. 요약하면 크게 3가지 단점이 존재한다
    - **성능 이슈**
        - 리플렉션 연산은 일반 Java 코드 실행보다 훨씬 느리고 오버헤드 가능성이 크다
            - 이는 리플렉션 메소드가 JVM 최적화의 대상이 아니기 때문이다.
        - 또한, 리플렉션에 대한 예외 처리 등과 같은 코드로 인해 코드 가독성이 안 좋아진다.
    - **잠재적인 보안 위험**
        - private 메소드와 필드에 접근할 수 있기 때문에 보안 문제가 발생할 수 있다.
    - **에러 체크 제약**
        - 컴파일 타임에는 타입 체크가 이루어지지 않고 런타임에 이루어지기 때문에 오류 추적 및 해결이 어렵다
- 위의 단점이 크기 때문에 인스턴스 생성에만 쓰고, 이렇게 만든 인스턴스는 인터페이스나 상위 클래스로 참조해 사용하는 것을 권장한다.

# Item 66. 네이티브 메서드는 신중히 사용하라

- 네이티브 메서드는 제약이 많기 때문에 정말 필요한 상황이 아니라 사용을 지양해야 한다.
    - 저수준 자원이나 네이티브 라이브러리를 사용해야하는 상황에서도 네이티브 코드는 최소한만 사용하고 철저히 테스트가 필요하다
- 또한, 성능을 개선할 목적으로 네이티브 메서드를 사용하는 것은 거의 권장하지 않는다.
    - 대부분의 상황에서 네이티브 메서드가 성능을 개선해주는 일은 적다.

## 네이티브 메서드

- C, C++ 같은 네이티브 프로그래밍 언어로 작성한 메서드
    - `JNI(Java Native Interface)`라는 기술에 의해 호출된다.

    ```java
    public class NativeExample {
        static {
    		    // "hello"라는 이름의 네이티브 라이브러리를 호출
            System.loadLibrary("hello");
        }
       
        // 라이브러리에 선언된 sayHello라는 네이티브 메서드를 호출
        public native void sayHello();
    }
    ```

- 네이티브 메서드는 성능 최적화, 하드웨어 접근, 기존 라이브러리의 재활용 등에 활용 가능하다.
    - 그러나 동시에 플랫폼 호환성, 메모리 관리, 디버깅의 어려움 등 문제 역시 존재한다.

### 네이티브 메서드의 제약

- 성능 개선 목적으로 사용하는 것을 권장하지 않는다.
    - JVM은 빠른 속도로 발전했기 때문에 현재는 특수한 경우가 아니면 네이티브 메서드가 필요 없을 정도로 많이 빨라졌다.
    - 단, 다중 정밀 연산 라이브러리(GMP)의 경우는 많은 개선이 있어와서 네이티브 메서드를 쓰는 것을 고려할 수 있다.
- 네이티브 메서드는 플랫폼에 영향을 많이 받기 때문에 이식성이 좋지 않다
    - 특히 디버깅하기가 어렵다.
    - 또한, 가비지 컬렉터에 의해 네이티브 메모리가 회수되지도 않는다.
- 자바 코드와 네이티브 코드의 경계를 넘어다니면서 생기는 비용도 있다.
    - `접착 코드(glue code)`로 불리며 다루기 귀찮고 가독성도 좋지 않다