# Effective Java

# Item 16. public 클래스에서는 public 필드가 아닌 접근자 메서드를 사용하라

- public 클래스는 절대 가변 필드를 직접 노출하지 말아야 한다.
    - 불변 필드라면 노출해도 상대적으로 덜 위험하지만, 최대한 노출하지 않아야 한다.
- package-private 클래스나 private 중첩 클래스에서는 종종 (불변이든 가변이든) 필드를 노출하는 편이 나을 수 도 있다.
    - 변경 여파가 패키지 내부에만 제한되므로 합리적이다.
    - 즉, 노출 범위가 제한적이고 제어 가능하기때문에 코드의 단순성과 효율성을 높일 수 있다!

## 접근자와 변경자

- 일반적으로 필드는 private이기에 외부에서 접근하기 위해서는 getter/setter를 활용한다.
- 접근자와 제어자를 활용하면 클래스 내부 표현을 자유롭게 바꿀 수 있는 유연성을 얻을 수 있다.
    - public 클래스가 필드를 공개하면 이를 사용하는 클라이언트가 생겨날 것이므로 내부 표현 방식을 마음대로 바꿀 수 없게 된다.

    ```java
    class Point {
    	private double x;
    	private double y;
    	
    	public Point(double x, double y) {
    		this.x = x;
    		this.y = y;
    	}
    
    	public double getX() { return x; }
    	public double getY() { return y; }
    
    	public void setX(double x) { this.x = x; }
    	public void setY(double y) { this.y = y; }
    }
    ```


### 접근자와 변경자의 주의 사항

- 필드를 직접 접근하는 것보다는 getter/setter를 사용하는 것이 훨씬 낫다
- 그렇지만, 무분별하게 사용할 경우 캡슐화를 깰 수 있기에 필요한 장소에서만 선언하는 것이 중요하다!


# Item 17. 변경 가능성을 최소화하라

- 불변 클래스를 통해 변경 하지 않는 객체를 만들 수 있다.
    - public 으로 제공해야 하는 클래스일 수록 변경 가능성을 최소화해야 하기에 불변 클래스가 하나의 답이 될 수 있다!

## 불변 클래스

- 생성 될 때 고정되어 객체가 파괴되는 순간까지 절대 변경되지 않는 클래스를 말한다.

### **불변 클래스의 장점**

- **가변 클래스보다 설계하고 구현하고 사용하기 쉽다.**
    - 단순하기 때문에 오류 가능성도 낮다!
    - 가변 인스턴스는 동일한 인스턴스를 활용하는 곳이 많아질수록 오류 가능성이 늘어날 수 있다
- **불변 객체는 근본적으로 스레드 안전하기 때문에 따로 동기화할 필요가 없다.**
    - 여러 스레드가 동시에 사용해도 절대 훼손되지 않는다.
    - 이로 인해 **불변 클래스는 재활용할 수 있고, 캐시를 활용해 성능을 개선**할 수 있다.
- **방어적 복사도 필요 없어진다**.
    - 아무리 복사해도 원본과 차이가 없기 때문에, 복사 자체가 의미가 없다.
    - 그리하여 불변 클래스는 clone이나 복사 생성자를 제공하지 말아야 한다.
- **객체를 만들 때 다른 불변 객체들을 구성요소로 사용**하면, 불변식을 유지하기 쉽다는 장점이 있다.
    - 대표적인 예로 불변 객체는 맵Map의 키와 집합Set의 원소가 있다.
- .**불변 클래스는 그 자체로 실패원자성을 제공**한다.
    - 상태가 절대 변하지 않으니 잠깐이라도 불일치 상태가 되지 않는다.

### 불변 클래스의 단점

- 값이 다르면 반드시 독립된 객체로 만들어야 한다.
    - 생성 및 변경의 비용이 큰 리소스인 경우에는 독립된 객체를 만드는 행위가 큰 점으로 다가온다.
- 단점을 극복하기 위한 방법으로 다단계 연산을 예측하여 제공하는 방식이 있다.
    - 더 이상 각 단계마다 객체를 생성하지 않기에 부담이 줄어든다.
- 정확히 예측할 수 없다면 public으로 가변 동반 클래스를 제공하는 것이 최선이다.
    - 대표적인 예로 String의 String Builder 클래스가 존재한다.

## **불변 클래스를 만드는 5가지 규칙**

- 객체의 상태를 변경하는 메서드(변경자)를 제공하지 않는다.
- 클래스를 확장할 수 없도록 한다.
- 모든 필드를 final로 선언한다.
- 모든 필드를 private로 선언한다.
- 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.

private final로 선언하면 5가지 규칙을 간단하게 지킬 수 있다!

## 주의 사항

- 클래스는 꼭 필요한 경우가 아니라면 불변이어야 한다.
    - getter를 작성한다고 무조건 setter를 작성해서는 안된다.
- 모든 클래스를 불변으로 만들 수 없다.
    - 그렇지만 불변으로 만들 수 없는 클래스라도 변경할 수 있는 부분을 최소한으로 줄여야 한다.
- **생성자는 불변식 설정이 모두 완료되고 초기화가 완벽히 끝난 상태의 객체를 생성해야 한다.**
    - 확실한 이유가 없다면 생성자와 정적 팩터리 외에는 그 어떤 초기화 메서드도 public으로 제공해서는 안 된다.
    - 객체를 재활용할 목적으로 상태를 다시 초기화하는 메서드도 제공해서는 안된다.

### **확장(상속)하지 못 하도록 하자**

- final class로 만들면 간단하지만 제약이 더 많다.
    - 그렇기에 일반적인 방식은 모든 생성자를 private 혹은 package-private로 만들고 public 정적 팩터리메서드를 통해 객체나 기능을 제공하는 것이다.
- 바깥에서 볼 수 없는 package-private 구현 클래스를 원하는 만큼 만들어 활용할 수 있으니 유연하고, 패키지 바깥에서 클라이언트가 바라본 이 불변 객체는 사실상 final이기 때문에 안전하다!