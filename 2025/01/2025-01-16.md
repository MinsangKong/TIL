# Effective Java

# Item 87. 커스텀 직렬화 형태를 고려해보라

- 기본 직렬화는 신중히 사용해야 한다.
    - 기본 직렬화 형태는 **객체의 물리적 표현**을 직렬화하기 때문에 객체의 **논리적 표현**과 다를 수 있다.
    - 결과적으로 내부 표현에 영구적으로 묶여버릴 수 있다.
- 필요에 따라 **커스텀 직렬화 형태**를 설계하고 기본 직렬화를 사용할 땐 객체의 불변성, 보안, 성능 등을 반드시 고려해야 한다.

## 기본 직렬화가 부적합할 경우 문제점

- **공개 API가 내부 구현에 종속**
    - 내부 필드나 클래스를 영구적으로 유지해야 한다.
    - 이로 인해 내부 구현 변경 시에도 이전 직렬화 구조를 지원해야 문제가 발생하지 않는다.
- **공간 낭비**
    - 직렬화 형태에 논리적으로 필요하지 않은 데이터까지 포함될 수 있다.
- **비효율성**
    - 직렬화/역직렬화 속도가 느려지고 불필요한 데이터 순회로 비용 증가한다.
- **스택 오버플로**
    - 연결 리스트 등과 같은 재귀적 구조에서 스택 오버플로가 발생할 수 있다.

### **해결 방안**

- **기본 직렬화는 논리적 표현과 물리적 표현이 같을 때만 사용한다.**
    - 객체의 물리적 표현이 논리적 상태와 정확히 일치하면 기본 직렬화를 고려해도 좋다.
    - 예를 들어 단순 문자열 목록을 표현하는 클래스 등에 적합하다.
- **커스텀 직렬화 형태 설계**
    - 기본 직렬화 대신 객체의 **논리적 상태**만 표현되도록 `writeObject`와 `readObject`를 반드시 활용한다.
    - `transient`를 활용하여 불필요한 필드 제외해야 한다.
    - 또한 직렬화 호환성을 고려해 `defaultWriteObject`와 `defaultReadObject`는 호출해야 한다.
- **직렬화 UID(serialVersionUID) 설정**
    - 모든 직렬화 가능 클래스에 설정하여 예상치 못한 호환성 문제를 방지해야 한다.
- **불변식 검증**
    - 역직렬화 시 `readObject`에서 **중요한 불변식**을 검증해 예외 처리를 진행해야 한다.